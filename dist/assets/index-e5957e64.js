import{u as ce}from"./setting-27cf6495.js";import{I as k,d as pe,r as i,c as me,G as fe,e as p,o as S,f as $,g as e,w as t,h as n,C,j as c,m as R,t as F,v as M,n as ve,F as B,q as _e,z as G,J as U,p as ge,k as ye,_ as be}from"./index-ea9679ea.js";const we=(s,d,g)=>k.get(`/admin/acl/user/${s}/${d}/?account=${g}`),Ve=s=>s.id?k.put("/admin/acl/user/update",s):k.post("/admin/acl/user/save",s),he=s=>k.get("/admin/acl/user/toAssign/"+s),Ce=s=>k.post("/admin/acl/user/doAssignRole",s),ke=s=>k.delete("/admin/acl/user/remove/"+s),xe=s=>k.delete("/admin/acl/user/batchRemove",{data:s}),Ue=s=>(ge("data-v-36ef1214"),s=s(),ye(),s),ze={style:{flex:"auto"}},Se=Ue(()=>R("h4",null,"分配角色(职位)",-1)),Re={style:{flex:"auto"}},qe=pe({__name:"index",setup(s){let d=i(1),g=i(5),E=i(0),z=i([]),f=i(!1),v=i(!1),x=i([]),y=i([]),r=me({account:"",name:"",password:""}),q=i([]),b=i(),w=i(""),j=ce();fe(()=>{V()});const V=async(o=1)=>{d.value=o;let l=await we(d.value,g.value,w.value);l.code==200&&(E.value=l.data.total,z.value=l.data.records)},H=()=>{V()},J=()=>{f.value=!0,Object.assign(r,{id:0,account:"",name:"",password:""}),G(()=>{b.value.clearValidate("account"),b.value.clearValidate("name"),b.value.clearValidate("password")})},K=o=>{f.value=!0,Object.assign(r,o),G(()=>{b.value.clearValidate("account"),b.value.clearValidate("name")})},Q=async()=>{await b.value.validate(),(await Ve(r)).code==200?(f.value=!1,U({type:"success",message:r.id?"更新成功":"添加成功"}),window.location.reload()):(f.value=!1,U({type:"error",message:r.id?"更新失败":"添加失败"}))},W=()=>{f.value=!1},X={account:[{required:!0,trigger:"blur",validator:(o,l,u)=>{l.trim().length>=5?u():u(new Error("用户名字至少五位"))}}],name:[{required:!0,trigger:"blur",validator:(o,l,u)=>{l.trim().length>=5?u():u(new Error("用户昵称至少五位"))}}],password:[{required:!0,trigger:"blur",validator:(o,l,u)=>{l.trim().length>=6?u():u(new Error("用户密码至少六位"))}}]},Y=async o=>{Object.assign(r,o);let l=await he(r.id);l.code==200&&(x.value=l.data.allRolesList,y.value=l.data.assignRoles,v.value=!0)},I=i(!1),A=i(!0),Z=o=>{y.value=o?x.value:[],A.value=!1},ee=o=>{I.value=o.length===x.value.length,A.value=o.length!==x.value.length},le=async()=>{let o={userId:r.id,roleIdList:y.value.map(u=>u.id)};(await Ce(o)).code==200&&(U({type:"success",message:"分配职务成功"}),v.value=!1,V(d.value))},ae=async o=>{(await ke(o)).code==200&&(U({type:"success",message:"删除成功"}),V(z.value.length>1?d.value:d.value-1))},te=o=>{q.value=o},oe=async()=>{let o=q.value.map(u=>u.id);(await xe(o)).code==200&&(U({type:"success",message:"删除成功"}),V(z.value.length>1?d.value:d.value-1))},ne=()=>{V(),w.value=""},re=()=>{j.refsh=!j.refsh};return(o,l)=>{const u=p("el-input"),h=p("el-form-item"),m=p("el-button"),N=p("el-form"),L=p("el-card"),_=p("el-table-column"),se=p("el-popconfirm"),ue=p("el-table"),de=p("el-pagination"),O=p("el-drawer"),P=p("el-checkbox"),ie=p("el-checkbox-group");return S(),$(B,null,[e(L,{style:{height:"80px"}},{default:t(()=>[e(N,{inline:!0,class:"form"},{default:t(()=>[e(h,{label:"用户名:"},{default:t(()=>[e(u,{placeholder:"请你输入搜索用户名",modelValue:n(w),"onUpdate:modelValue":l[0]||(l[0]=a=>C(w)?w.value=a:w=a)},null,8,["modelValue"])]),_:1}),e(h,null,{default:t(()=>[e(m,{type:"primary",size:"default",disabled:!n(w),onClick:ne},{default:t(()=>[c("搜索")]),_:1},8,["disabled"]),e(m,{type:"primary",size:"default",onClick:re},{default:t(()=>[c("重置")]),_:1})]),_:1})]),_:1})]),_:1}),e(L,{style:{margin:"10px 0px"}},{default:t(()=>[e(m,{type:"primary",size:"default",onClick:J},{default:t(()=>[c("添加用户")]),_:1}),e(m,{type:"primary",size:"default",disabled:!n(q).length,onClick:oe},{default:t(()=>[c("批量删除")]),_:1},8,["disabled"]),e(ue,{onSelectionChange:te,style:{margin:"10px 0px"},border:"",data:n(z)},{default:t(()=>[e(_,{type:"selection",align:"center"}),e(_,{label:"#",align:"center",type:"index"}),e(_,{label:"ID",align:"center",prop:"id"}),e(_,{label:"用户名字",align:"center",prop:"account","show-overflow-tooltip":""}),e(_,{label:"用户名称",align:"center",prop:"name","show-overflow-tooltip":""}),e(_,{label:"用户角色",align:"center",prop:"roleName","show-overflow-tooltip":""}),e(_,{label:"创建时间",align:"center",prop:"createTime","show-overflow-tooltip":""}),e(_,{label:"更新时间",align:"center",prop:"updateTime","show-overflow-tooltip":""}),e(_,{label:"操作",width:"300px",align:"center"},{default:t(({row:a,$index:T})=>[e(m,{type:"primary",size:"small",icon:"User",onClick:D=>Y(a)},{default:t(()=>[c("分配角色")]),_:2},1032,["onClick"]),e(m,{type:"primary",size:"small",icon:"Edit",onClick:D=>K(a)},{default:t(()=>[c("编辑")]),_:2},1032,["onClick"]),e(se,{title:`你确定要删除${a.account}?`,width:"260px",onConfirm:D=>ae(a.id)},{reference:t(()=>[e(m,{type:"primary",size:"small",icon:"Delete"},{default:t(()=>[c("删除")]),_:1})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),e(de,{"current-page":n(d),"onUpdate:currentPage":l[1]||(l[1]=a=>C(d)?d.value=a:d=a),"page-size":n(g),"onUpdate:pageSize":l[2]||(l[2]=a=>C(g)?g.value=a:g=a),"page-sizes":[5,7,9,11],background:!0,layout:"prev, pager, next, jumper,->,sizes,total",total:n(E),onCurrentChange:V,onSizeChange:H},null,8,["current-page","page-size","total"])]),_:1}),e(O,{modelValue:n(f),"onUpdate:modelValue":l[6]||(l[6]=a=>C(f)?f.value=a:f=a)},{header:t(()=>[R("h4",null,F(n(r).id?"更新用户":"添加用户"),1)]),default:t(()=>[e(N,{model:n(r),rules:X,ref_key:"formRef",ref:b},{default:t(()=>[e(h,{label:"用户姓名",prop:"account"},{default:t(()=>[e(u,{placeholder:"请您输入用户姓名",modelValue:n(r).account,"onUpdate:modelValue":l[3]||(l[3]=a=>n(r).account=a)},null,8,["modelValue"])]),_:1}),e(h,{label:"用户昵称",prop:"name"},{default:t(()=>[e(u,{placeholder:"请您输入用户昵称",modelValue:n(r).name,"onUpdate:modelValue":l[4]||(l[4]=a=>n(r).name=a)},null,8,["modelValue"])]),_:1}),n(r).id?ve("",!0):(S(),M(h,{key:0,label:"用户密码",prop:"password"},{default:t(()=>[e(u,{placeholder:"请您输入用户密码",modelValue:n(r).password,"onUpdate:modelValue":l[5]||(l[5]=a=>n(r).password=a)},null,8,["modelValue"])]),_:1}))]),_:1},8,["model"])]),footer:t(()=>[R("div",ze,[e(m,{onClick:W},{default:t(()=>[c("取消")]),_:1}),e(m,{type:"primary",onClick:Q},{default:t(()=>[c("确定")]),_:1})])]),_:1},8,["modelValue"]),e(O,{modelValue:n(v),"onUpdate:modelValue":l[11]||(l[11]=a=>C(v)?v.value=a:v=a)},{header:t(()=>[Se]),default:t(()=>[e(N,null,{default:t(()=>[e(h,{label:"用户姓名"},{default:t(()=>[e(u,{modelValue:n(r).account,"onUpdate:modelValue":l[7]||(l[7]=a=>n(r).account=a),disabled:!0},null,8,["modelValue"])]),_:1}),e(h,{label:"职位列表"},{default:t(()=>[e(P,{onChange:Z,modelValue:I.value,"onUpdate:modelValue":l[8]||(l[8]=a=>I.value=a),indeterminate:A.value},{default:t(()=>[c("全选")]),_:1},8,["modelValue","indeterminate"]),e(ie,{modelValue:n(y),"onUpdate:modelValue":l[9]||(l[9]=a=>C(y)?y.value=a:y=a),onChange:ee},{default:t(()=>[(S(!0),$(B,null,_e(n(x),(a,T)=>(S(),M(P,{key:T,label:a},{default:t(()=>[c(F(a.roleName),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),footer:t(()=>[R("div",Re,[e(m,{onClick:l[10]||(l[10]=a=>C(v)?v.value=!1:v=!1)},{default:t(()=>[c("取消")]),_:1}),e(m,{type:"primary",onClick:le},{default:t(()=>[c("确定")]),_:1})])]),_:1},8,["modelValue"])],64)}}});const Le=be(qe,[["__scopeId","data-v-36ef1214"]]);export{Le as default};
